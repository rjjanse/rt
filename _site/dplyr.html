<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./tidyverse.html">Into the tidyverse</a></li><li class="breadcrumb-item"><a href="./dplyr.html">Dplyr</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Start</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Set-up</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RStudio</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">The basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./creating.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./using.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Into the tidyverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tidyverse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Dplyr</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">tidyr.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">magrittr.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Into the multiverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">datatable.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">shiny.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">New skills</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">random.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">functions.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">looping.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">iterating.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">regex.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Workflow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">scripts.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">rmarkdown.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">General use</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">regression.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">plotting.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">table1.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text">Specific use</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">imputation.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">confounding.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">prediction.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">competing_risks.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
 <span class="menu-text">Recap</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">rython.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">slow.qmd</span>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#dplyr" id="toc-dplyr" class="nav-link active" data-scroll-target="#dplyr">Dplyr</a></li>
  <li><a href="#renaming-and-relocating" id="toc-renaming-and-relocating" class="nav-link" data-scroll-target="#renaming-and-relocating">Renaming and relocating</a></li>
  <li><a href="#filtering-and-selecting" id="toc-filtering-and-selecting" class="nav-link" data-scroll-target="#filtering-and-selecting">Filtering and selecting</a></li>
  <li><a href="#mutating-and-conditionals" id="toc-mutating-and-conditionals" class="nav-link" data-scroll-target="#mutating-and-conditionals">Mutating and conditionals</a></li>
  <li><a href="#working-across-columns" id="toc-working-across-columns" class="nav-link" data-scroll-target="#working-across-columns">Working across columns</a></li>
  <li><a href="#the-pipe" id="toc-the-pipe" class="nav-link" data-scroll-target="#the-pipe">The pipe: <code>%&gt;%</code></a></li>
  <li><a href="#grouping-and-slicing" id="toc-grouping-and-slicing" class="nav-link" data-scroll-target="#grouping-and-slicing">Grouping and slicing</a>
  <ul>
  <li><a href="#grouping-functions" id="toc-grouping-functions" class="nav-link" data-scroll-target="#grouping-functions">Grouping functions</a></li>
  </ul></li>
  <li><a href="#summarising-groups" id="toc-summarising-groups" class="nav-link" data-scroll-target="#summarising-groups">Summarising groups</a>
  <ul>
  <li><a href="#count-and-tally" id="toc-count-and-tally" class="nav-link" data-scroll-target="#count-and-tally">Count and tally</a></li>
  </ul></li>
  <li><a href="#joins" id="toc-joins" class="nav-link" data-scroll-target="#joins">Joins</a></li>
  <li><a href="#understanding-pipelines" id="toc-understanding-pipelines" class="nav-link" data-scroll-target="#understanding-pipelines">Understanding pipelines</a>
  <ul>
  <li><a href="#tidy-data-tutor" id="toc-tidy-data-tutor" class="nav-link" data-scroll-target="#tidy-data-tutor">Tidy data tutor</a></li>
  <li><a href="#microsoft-datamations" id="toc-microsoft-datamations" class="nav-link" data-scroll-target="#microsoft-datamations">Microsoft datamations</a></li>
  </ul></li>
  <li><a href="#other-useful-functions" id="toc-other-useful-functions" class="nav-link" data-scroll-target="#other-useful-functions">Other useful functions</a>
  <ul>
  <li><a href="#selecting-parts-of-our-data" id="toc-selecting-parts-of-our-data" class="nav-link" data-scroll-target="#selecting-parts-of-our-data">Selecting parts of our data</a></li>
  <li><a href="#getting-information-on-and-in-our-data" id="toc-getting-information-on-and-in-our-data" class="nav-link" data-scroll-target="#getting-information-on-and-in-our-data">Getting information on and in our data</a></li>
  <li><a href="#manipulating-our-data" id="toc-manipulating-our-data" class="nav-link" data-scroll-target="#manipulating-our-data">Manipulating our data</a></li>
  </ul></li>
  <li><a href="#extensions" id="toc-extensions" class="nav-link" data-scroll-target="#extensions">Extensions</a>
  <ul>
  <li><a href="#dtplyr" id="toc-dtplyr" class="nav-link" data-scroll-target="#dtplyr"><code>{dtplyr}</code></a></li>
  <li><a href="#dbplyr" id="toc-dbplyr" class="nav-link" data-scroll-target="#dbplyr"><code>{dbplyr}</code></a></li>
  <li><a href="#sparklyr" id="toc-sparklyr" class="nav-link" data-scroll-target="#sparklyr"><code>{sparklyr}</code></a></li>
  </ul></li>
  <li><a href="#wrapping-up" id="toc-wrapping-up" class="nav-link" data-scroll-target="#wrapping-up">Wrapping up</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul>
  <li><a href="#subset-data" id="toc-subset-data" class="nav-link" data-scroll-target="#subset-data">1. Subset data</a></li>
  <li><a href="#create-weight-category" id="toc-create-weight-category" class="nav-link" data-scroll-target="#create-weight-category">2. Create weight category</a></li>
  <li><a href="#drop-columns" id="toc-drop-columns" class="nav-link" data-scroll-target="#drop-columns">3. Drop columns</a></li>
  <li><a href="#get-group-statistics" id="toc-get-group-statistics" class="nav-link" data-scroll-target="#get-group-statistics">4. Get group statistics</a></li>
  <li><a href="#put-it-all-in-a-pipeline" id="toc-put-it-all-in-a-pipeline" class="nav-link" data-scroll-target="#put-it-all-in-a-pipeline">5. Put it all in a pipeline</a></li>
  </ul></li>
  <li><a href="#next-topic" id="toc-next-topic" class="nav-link" data-scroll-target="#next-topic">Next topic</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./tidyverse.html">Into the tidyverse</a></li><li class="breadcrumb-item"><a href="./dplyr.html">Dplyr</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Dplyr</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="dplyr" class="level2">
<h2 class="anchored" data-anchor-id="dplyr">Dplyr</h2>
<p><code>{dplyr}</code>, a combination of data and plier, is a package that allows manipulation of data in an easy and efficient way. Whether you want to drop columns, drop rows, create new variables, or change old variables, <code>{dplyr}</code> allows you to do this in an intuitive way which requires little code (especially compared to base R). If you have not already installed and loaded <code>{dplyr}</code>, you can do so with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load dplyr</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(<span class="st">"dplyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this section, we will work with the <code>starwars</code> dataset, that is automatically loaded in when you load <code>{dplyr}</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Show first 5 rows of starwars</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">head</span>(starwars, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 14
  name      height  mass hair_color skin_color eye_color birth_year sex   gender
  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Luke Sky…    172    77 blond      fair       blue            19   male  mascu…
2 C-3PO        167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
3 R2-D2         96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
4 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…
5 Leia Org…    150    49 brown      light      brown           19   fema… femin…
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<p>Let’s load the <code>starwars</code> data into our Global Environment so that we can easily access it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Load starwars into Global Environment object called sw</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>sw <span class="ot">&lt;-</span> starwars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All <code>{dplyr}</code> functions that take a data frame or tibble start with the <code>.data</code> argument. Therefore, in all examples below, we first specify our <code>.data</code> as <code>sw</code> before supplying arguments of the function.</p>
</section>
<section id="renaming-and-relocating" class="level2">
<h2 class="anchored" data-anchor-id="renaming-and-relocating">Renaming and relocating</h2>
<p>Before we can do anything to the data itself, we should make sure we like the names of the variables. Three of the variables contain the word ‘color’ (<code>hair_color</code>, <code>skin_color</code>, <code>eye_color</code>). However, we might think it is intuitive enough that these variables indicate colour, so maybe we want to change those names. For this we can use the function <code>rename()</code>. In <code>rename()</code>, we specify any number of arguments we want, where the left hand side of the argument indicates the new column name and the righth and side of the argument indicates the column that needs to be changed (and therefore the old column name). The right hand side can also be the position of the column (e.g., 2 for the second column).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Rename variables</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>sw <span class="ot">&lt;-</span> <span class="fu">rename</span>(sw, <span class="at">hair =</span> hair_color, <span class="at">skin =</span> skin_color, <span class="at">eye =</span> eye_color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Many functions, among which functions in <code>{dplyr}</code> like <code>rename()</code> have an argument called <code>...</code>. This ellipsis simply means that you can supply any number of arguments of the type that the function uses. For <code>rename()</code>, this means we can supply an endless list of variables to be renamed.</p>
</div>
</div>
</div>
<p>Now our data has some changed names, but we are not done yet. It might also be preferable that sex and gender are mentioned immediately after the name. To do this, we can simply use <code>relocate()</code>. In <code>relocate()</code>, we specify a group of columns and specify before (argument <code>.before</code>) or after (argument <code>.after</code>) which column they should be placed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Relocate variables</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>sw <span class="ot">&lt;-</span> <span class="fu">relocate</span>(sw, sex<span class="sc">:</span>gender, <span class="at">.after =</span> name)</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># This has the same effect</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>sw <span class="ot">&lt;-</span> <span class="fu">relocate</span>(sw, <span class="fu">c</span>(sex, gender), <span class="at">.before =</span> height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-and-selecting" class="level2">
<h2 class="anchored" data-anchor-id="filtering-and-selecting">Filtering and selecting</h2>
<p>Now that our data is a bit more how we (or I?) wanted it, we can also determine whether there are some columns or rows that we do not actually want or need. First of, because I am not interested in any data from outside the starwars universe, we can remove the column <code>films</code>. To do this, we use <code>select()</code>, which allows us to either specify the columns we want to keep, or specify the columns we want to drop. To keep columns, we simply name them and to drop columns we name them with a dash/minus sign before (-).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Drop films column</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>sw <span class="ot">&lt;-</span> <span class="fu">select</span>(sw, <span class="sc">-</span>films)</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># This does the same thing</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>sw <span class="ot">&lt;-</span> <span class="fu">select</span>(sw, name<span class="sc">:</span>species, vehicles<span class="sc">:</span>starships)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Additionally, I am not interested in any character (i.e., row) of who we do not know the mass or who is from Tatooine. Tatooine is full of sand and I don’t like sand. It’s coarse and rough. To remove rows, we can use the <code>filter()</code> function. In <code>filter()</code>, we supply conditions to which rows must adhere to stay.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Remove rows with missing mass or with characters from Tatooine</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>sw <span class="ot">&lt;-</span> <span class="fu">filter</span>(sw, <span class="sc">!</span><span class="fu">is.na</span>(mass) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(height) <span class="sc">&amp;</span> homeworld <span class="sc">!=</span> <span class="st">"Tatooine"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we use <code>is.na()</code> to see what rows are missing in the column <code>mass</code> and then take the reverse (!). We do the same for <code>height</code>. Additionally (&amp;), the homeworld should not equal (!=) Tatooine.</p>
</section>
<section id="mutating-and-conditionals" class="level2">
<h2 class="anchored" data-anchor-id="mutating-and-conditionals">Mutating and conditionals</h2>
<p>Now that we have the data that we want, we might want to create some new variables. For instance, it would be interesting to know the Body Mass Index (BMI) of the characters, which we can calculate because we have height and mass. We can do that with <code>mutate()</code>. In this function, we can specify any number of arguments, with the left hand side of the argument being the name of the new variable and the right hand side being the value it should take.</p>
<p>A great characteristic of <code>mutate()</code> is that we can immediately use a variable we just calculted within the same <code>mutate()</code> function call. For instance, if we calculate BMI, we can immediately create a variable that indicates whether according to commonly used BMI dichotomisation for humans, a character classifies as overweight or not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Calculate BMI and overweight indicator</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>sw <span class="ot">&lt;-</span> <span class="fu">mutate</span>(sw, </span>
<span id="cb9-3"><a href="#cb9-3"></a>             <span class="co"># Change height to meters</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>             <span class="at">height =</span> height <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb9-5"><a href="#cb9-5"></a>             <span class="co"># Calculate BMI</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>             <span class="at">bmi =</span> mass <span class="sc">/</span> height <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb9-7"><a href="#cb9-7"></a>             <span class="co"># Create indicator for overweight</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>             <span class="at">overweight =</span> <span class="fu">ifelse</span>(bmi <span class="sc">&gt;=</span> <span class="dv">25</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb9-9"><a href="#cb9-9"></a></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co"># Show summary of BMI</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="fu">summary</span>(sw[[<span class="st">"bmi"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  12.89   19.48   23.83   32.40   25.86  443.43 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Show table of overweight</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">table</span>(sw[[<span class="st">"overweight"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 0  1 
32 16 </code></pre>
</div>
</div>
<p>What we used to create the overweight variable was an if-else clause, which is a commonly used clause in programming. Simply, it checks whether a condition is true. If a condition is true, then it does A, otherwise it does B. In this case, <code>ifelse()</code> checks the condition <code>bmi &gt;= 25</code>. If that condition is <code>TRUE</code>, then the variable <code>overweight</code> is assigned a 1, otherwise a 0.</p>
<p>If we want to be able to assign more than two values based on a single conditions, we can use two approaches. First, we can nest multiple <code>ifelse()</code> statements. Below, we code a variable <code>weight_status</code> which indicates underweight (BMI &lt; 18, 1), normal weight (BMI 18-25, 2), overweight (BMI &gt;25, 3), and obesity (BMI &gt;30, 4).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Create new variable weight status</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>sw <span class="ot">&lt;-</span> <span class="fu">mutate</span>(sw, </span>
<span id="cb13-3"><a href="#cb13-3"></a>             <span class="co"># Create indicator for weight status</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>             <span class="at">weight_status =</span> <span class="fu">ifelse</span>(bmi <span class="sc">&lt;</span> <span class="dv">18</span>, <span class="dv">1</span>,</span>
<span id="cb13-5"><a href="#cb13-5"></a>                                    <span class="fu">ifelse</span>(bmi <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> bmi <span class="sc">&lt;=</span> <span class="dv">25</span>, <span class="dv">2</span>,</span>
<span id="cb13-6"><a href="#cb13-6"></a>                                           <span class="fu">ifelse</span>(bmi <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">&amp;</span> bmi <span class="sc">&lt;=</span> <span class="dv">30</span>, <span class="dv">3</span>, <span class="dv">4</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This can quickly become unreadable if more groups should be made. Luckily, <code>{dplyr}</code> offers us <code>case_when()</code> and <code>case_match()</code>. Using <code>case_when()</code>, we only need to call one function and then supply all conditions. In <code>case_when()</code> this is written as condition ~ result:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Create new variable weight status</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>sw <span class="ot">&lt;-</span> <span class="fu">mutate</span>(sw, </span>
<span id="cb14-3"><a href="#cb14-3"></a>             <span class="co"># Create indicator for weight status</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>             <span class="at">weight_status =</span> <span class="fu">case_when</span>(bmi <span class="sc">&lt;</span> <span class="dv">18</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb14-5"><a href="#cb14-5"></a>                                       bmi <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> bmi <span class="sc">&lt;=</span> <span class="dv">25</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb14-6"><a href="#cb14-6"></a>                                       bmi <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">&amp;</span> bmi <span class="sc">&lt;=</span> <span class="dv">30</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb14-7"><a href="#cb14-7"></a>                                       <span class="at">.default =</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We also specify <code>.default = 4</code>, which means that any row without a matched condition should receive the value 4. However, be careful if you have missing data, as <code>.default</code> will also fill in those values. If <code>.default</code> is not supplied, any row not matching a condition will get an <code>NA</code>.</p>
<p><code>case_when()</code> is a great function and especially useful for multiple conditions that can be matched based on multiple columns or when we want to use conditions (&gt;, &lt;=, <em>etc</em>). Nonetheless, if we want to use only a single variable and do not need conditions, we can also use <code>case_match()</code>, where first the used variable is specified and then the matches, without having to respecify the variable in every match:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Create new variable weight status</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>sw <span class="ot">&lt;-</span> <span class="fu">mutate</span>(sw,</span>
<span id="cb15-3"><a href="#cb15-3"></a>             <span class="co"># Create indicator for weight status</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>             <span class="at">weight_status =</span> <span class="fu">case_match</span>(species,</span>
<span id="cb15-5"><a href="#cb15-5"></a>                                        <span class="st">"Human"</span> <span class="sc">~</span> <span class="st">"Humanoid"</span>,</span>
<span id="cb15-6"><a href="#cb15-6"></a>                                        <span class="st">"Yoda's species"</span> <span class="sc">~</span> <span class="st">"Small, green, and wrinkly with pointy ears"</span>,</span>
<span id="cb15-7"><a href="#cb15-7"></a>                                        <span class="at">.default =</span> species))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="working-across-columns" class="level2">
<h2 class="anchored" data-anchor-id="working-across-columns">Working across columns</h2>
<p>There might be a case where we want to change all numeric variables to character. In such case, we could write an extensive mutate argument as follows:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Change numerics to character</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>sw <span class="ot">&lt;-</span> <span class="fu">mutate</span>(sw,</span>
<span id="cb16-3"><a href="#cb16-3"></a>             <span class="co"># Change height</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>             <span class="at">height =</span> <span class="fu">as.character</span>(height),</span>
<span id="cb16-5"><a href="#cb16-5"></a>             <span class="co"># Change mass</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>             <span class="at">mass =</span> <span class="fu">as.character</span>(mass),</span>
<span id="cb16-7"><a href="#cb16-7"></a>             <span class="co"># Change birth year</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>             <span class="at">birth_year =</span> <span class="fu">as.character</span>(birth_year),</span>
<span id="cb16-9"><a href="#cb16-9"></a>             <span class="co"># Change BMI</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>             <span class="at">bmi =</span> <span class="fu">as.character</span>(bmi))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Even without the way of annotating that I try to circulate, this code would be unefficient to write. <code>{dplyr}</code> offers us <code>across()</code> to make our lives easier in such cases. With <code>across()</code>, we can apply multiple functions immediately to mulitple columns. If we want to change all those columns to character and check how many characters each has, we could simply do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Change numerics to character and show last 7 columns</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">mutate</span>(sw, <span class="fu">across</span>(<span class="fu">c</span>(height, mass, birth_year, bmi), <span class="fu">list</span>(<span class="at">char =</span> as.character, <span class="at">charn =</span> nchar)))[<span class="dv">18</span><span class="sc">:</span><span class="dv">24</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 48 × 7
   height_charn mass_char mass_charn birth_year_char birth_year_charn bmi_char  
          &lt;int&gt; &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;                      &lt;int&gt; &lt;chr&gt;     
 1            4 32                 2 33                             2 34.722222…
 2            3 49                 2 19                             2 21.777777…
 3            4 77                 2 57                             2 23.245984…
 4            4 112                3 200                            3 21.545090…
 5            3 80                 2 29                             2 24.691358…
 6            4 74                 2 44                             2 24.725182…
 7            4 1358               4 600                            3 443.42857…
 8            3 77                 2 21                             2 26.643598…
 9            3 110                3 &lt;NA&gt;                          NA 33.950617…
10            3 75                 2 82                             2 25.951557…
# ℹ 38 more rows
# ℹ 1 more variable: bmi_charn &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="the-pipe" class="level2">
<h2 class="anchored" data-anchor-id="the-pipe">The pipe: <code>%&gt;%</code></h2>
<p>Before we continue with other useful <code>{dplyr}</code> functions, we should talk about the pipe operator <code>%&gt;%</code>. Although <code>%&gt;%</code> is not originally from <code>{dplyr}</code> but instead imported from <code>{magrittr}</code> that we will discuss after this section.</p>
<p>Normally, if we wanted to apply multiple functions at the same time (for instance, <code>filter()</code> and <code>select()</code> after one another), we would nest the functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Keep only the birth year column and then keep only birth years above 100</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">filter</span>(<span class="fu">select</span>(starwars, birth_year), birth_year <span class="sc">&gt;</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 1
  birth_year
       &lt;dbl&gt;
1        112
2        200
3        600
4        896
5        102</code></pre>
</div>
</div>
<p>However, this quickly becomes unreadable. With <code>%&gt;%</code>, we can transform this into more readable code. What <code>%&gt;%</code> does is that it takes the outputted result from the previous function and feeds it into an argument in the next function called <code>.data</code> or <code>data</code> (if this argument is available). We will go into more detail in <a href="magrittr.qmd"><code>{magrittr}</code></a>.</p>
<p>So, with <code>%&gt;%</code>, we can rewrite the above code as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Take starwars data</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>    <span class="co"># Keep only birth year column</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>    <span class="fu">select</span>(birth_year) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>    <span class="co"># Keep only birth years above 100</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>    <span class="fu">filter</span>(birth_year <span class="sc">&gt;</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 1
  birth_year
       &lt;dbl&gt;
1        112
2        200
3        600
4        896
5        102</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Some more about annotation: with pipe operators, we can make our code much clearer and with that also our annotations. My personal preference is to annotate each new function after a pipe, so that it becomes even more readable. These annotations might just describe what we are doing, or give more details about why we are doing it. This makes it understandable to people who might not understand R equally well or know the functions we are using and allows better understanding of choices we made.</p>
</div>
</div>
</div>
</section>
<section id="grouping-and-slicing" class="level2">
<h2 class="anchored" data-anchor-id="grouping-and-slicing">Grouping and slicing</h2>
<p>Now that we know about pipe operators, we can apply them to some nice <code>{dplyr}</code> functions. Sometimes, we might want to calculate some statistics per group in our data. To do this, we can group the data on the variable(s) that define the groups and then run our analyses. Before we group, we must make sure the data are sorted so that all variables are already ordered in groups. We can do this with <code>arrange()</code>, which arranges variables in the order that you supply them to the function. If you want to arrange a variable in descending order, you can wrap it in <code>desc()</code>. Subsequently, we make the groups with <code>group_by()</code>, which makes groups in the order that the variables are supplied. When we are done working in the groups, we can ungroup the data again with <code>ungroup()</code>. For example, if we want to calculate the mean BMI per sex, we can do the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Calculate mean BMI in strata of sex</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>sw <span class="ot">&lt;-</span> sw <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>    <span class="co"># Arrange for grouping</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>    <span class="fu">arrange</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>    <span class="co"># Group on sex</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>    <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>    <span class="co"># Calculate mean BMI</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>    <span class="fu">mutate</span>(<span class="at">mean_bmi =</span> <span class="fu">mean</span>(bmi)) <span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>    <span class="co"># Ungroup again</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>    <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, I am actually interested in the mean BMI per groups of sex and gender and only want to keep one row per group. For this, we can use <code>slice()</code>, which allows us subset rows based on their position.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Calculate mean BMI in strata of sex</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>sw <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>    <span class="co"># Arrange for grouping</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>    <span class="fu">arrange</span>(sex, gender) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>    <span class="co"># Group on sex and then gender</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>    <span class="fu">group_by</span>(sex, gender) <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7"></a>    <span class="co"># Calculate mean BMI</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>    <span class="fu">mutate</span>(<span class="at">mean_bmi =</span> <span class="fu">mean</span>(bmi)) <span class="sc">%&gt;%</span></span>
<span id="cb24-9"><a href="#cb24-9"></a>    <span class="co"># Keep one row per group</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>    <span class="fu">slice</span>(<span class="dv">1</span>L) <span class="sc">%&gt;%</span>           <span class="co"># Note that 1L means that 1 is an integer</span></span>
<span id="cb24-11"><a href="#cb24-11"></a>    <span class="co"># Ungroup again</span></span>
<span id="cb24-12"><a href="#cb24-12"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-13"><a href="#cb24-13"></a>    <span class="co"># Keep only sex, gender, and mean BMI</span></span>
<span id="cb24-14"><a href="#cb24-14"></a>    <span class="fu">select</span>(sex, gender, mean_bmi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  sex            gender    mean_bmi
  &lt;chr&gt;          &lt;chr&gt;        &lt;dbl&gt;
1 female         feminine      17.8
2 hermaphroditic masculine    443. 
3 male           masculine     24.6
4 none           masculine     34.7
5 &lt;NA&gt;           &lt;NA&gt;          24.6</code></pre>
</div>
</div>
<p><code>slice()</code> is a general function but has some more specifications such as <code>slice_head()</code> and <code>slice_tail()</code> which you can read about in the <code>slice()</code> help function (<a href="https://dplyr.tidyverse.org/reference/slice.html"><code>?slice</code></a>).</p>
<section id="grouping-functions" class="level3">
<h3 class="anchored" data-anchor-id="grouping-functions">Grouping functions</h3>
<p>When we group our data, we can also extract some metadata about the groups we created with the following functions:</p>
<ul>
<li><p><code>group_data()</code>: metadata that defines the grouping structure</p></li>
<li><p><code>group_keys()</code>: metadata that describes the groups</p></li>
<li><p><code>group_rows()</code>: location of the rows in the original data per group</p></li>
<li><p><code>group_indices()</code>: a vector with the group to which each row belongs</p></li>
<li><p><code>group_vars()</code>: names of the grouping variables as a character</p></li>
<li><p><code>groups()</code>: names of the grouping variables as a list</p></li>
<li><p><code>group_size()</code>: size of each group</p></li>
<li><p><code>n_groups()</code>: the number of groups</p></li>
</ul>
</section>
</section>
<section id="summarising-groups" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="summarising-groups">Summarising groups</h2>
<p>Of course it is great to be able to calculate variables within groups, but there is an easier way to quickly get information on a group level with <code>summarise()</code>. This function creates a new data frame with any summary statistic that we specify per group. For instance, to calculate the mean and standard deviation of the birth year and the proportion of individuals without hair per planet, we can do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Use starwars</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>sw <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>    <span class="co"># Arrange for grouping</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>    <span class="fu">arrange</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>    <span class="co"># Group on sex</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>    <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>    <span class="co"># Calculate summary statistics</span></span>
<span id="cb26-8"><a href="#cb26-8"></a>    <span class="fu">summarise</span>(<span class="co"># Mean</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>              <span class="at">mean =</span> <span class="fu">mean</span>(birth_year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-10"><a href="#cb26-10"></a>              <span class="co"># Standard deviation</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>              <span class="at">sd =</span> <span class="fu">sd</span>(birth_year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-12"><a href="#cb26-12"></a>              <span class="co"># Proportion of no hair</span></span>
<span id="cb26-13"><a href="#cb26-13"></a>              <span class="at">prop_no_hair =</span> <span class="fu">sum</span>(hair <span class="sc">==</span> <span class="st">"none"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  sex             mean    sd prop_no_hair
  &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;
1 female          42.2  14.5        0.375
2 hermaphroditic 600    NA          0    
3 male            57.6  42.5        0.6  
4 none            33    NA          0    
5 &lt;NA&gt;           NaN    NA          0.333</code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p>The code for calculating the proportion of no hair was kindly supplied by Vera Broek.</p>
</div></div><p>Note that the <code>NA</code>s in the output result from the fact that we cannot take the standard deviation of a single observation. One of the functions we used was <code>n()</code>. This is one of the context functions supplied by <code>{dplyr}</code>, which allows us to quickly compute a group-specific variable. The available context functions are:</p>
<ul>
<li><p><code>n()</code>: the number of rows/observations in the group</p></li>
<li><p><code>cur_group()</code>: the group keys (grouping variables)</p></li>
<li><p><code>cur_group_id()</code>: gives the group a unique identifier</p></li>
<li><p><code>cur_group_rows()</code>: gives the row indices in the ungrouped data for the current group</p></li>
<li><p><code>cur_column()</code>: gives the name of the current column (only works in <code>across()</code>)</p></li>
</ul>
<section id="count-and-tally" class="level3">
<h3 class="anchored" data-anchor-id="count-and-tally">Count and tally</h3>
<p><code>tally()</code> and <code>count()</code> are two wrappers around summarise:</p>
<ul>
<li><p><code>tally()</code> is equal to summarise but automatically calls <code>n()</code> (if it’s the first tally) or <code>sum()</code> (if it’s the second tally), and therefore an easy shorthand for <code>summarise(n = n())</code>.</p></li>
<li><p><code>count()</code> is equal to <code>group_by()</code> followed by <code>summarise(n = n())</code> and closed with <code>ungroup()</code>.</p></li>
</ul>
</section>
</section>
<section id="joins" class="level2">
<h2 class="anchored" data-anchor-id="joins">Joins</h2>
<p>There might be times where we work with data that is stored in different data sets. If we want to combine these data sets, e.g., <code>x</code> and <code>y</code>, into one bigger data set, we will often want to do this on the basis of one or more variables, such as a unique study participant identifier and/or a visit number. In this case, we can use joins from <code>{dplyr}</code>, which offers four joins. These joins all add the data together, but differ in what they do with individuals that are not matched in either dataset.</p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 41%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Will keep all observations in</th>
<th>Can drop observations in</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>inner_join()</code></td>
<td><em>neither</em></td>
<td><code>x</code> and <code>y</code></td>
</tr>
<tr class="even">
<td><code>left_join()</code></td>
<td><code>x</code></td>
<td><code>y</code></td>
</tr>
<tr class="odd">
<td><code>right_join()</code></td>
<td><code>y</code></td>
<td><code>x</code></td>
</tr>
<tr class="even">
<td><code>full_join()</code></td>
<td><code>x</code> and <code>y</code></td>
<td><em>neither</em></td>
</tr>
</tbody>
</table>
<p>To use a join function, we use a pipe operator after the data we want to be joined on (<code>x</code>) and then specify on what column we want to join the data.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Get some columns from starwars</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>starwars_x <span class="ot">&lt;-</span> starwars[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb28-3"><a href="#cb28-3"></a></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="co"># Get some more columns from starwars</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>starwars_y <span class="ot">&lt;-</span> starwars[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb28-6"><a href="#cb28-6"></a></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="co"># Join data together based on the name</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>starwars_z <span class="ot">&lt;-</span> starwars_x <span class="sc">%&gt;%</span></span>
<span id="cb28-9"><a href="#cb28-9"></a>    <span class="co"># Join some more columns from starwars</span></span>
<span id="cb28-10"><a href="#cb28-10"></a>    <span class="fu">left_join</span>(starwars_y, <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we would want to join on more columns than only <code>name</code>, we can put the joining columns in a vector with <code>c()</code>.</p>
</section>
<section id="understanding-pipelines" class="level2">
<h2 class="anchored" data-anchor-id="understanding-pipelines">Understanding pipelines</h2>
<p>With the <code>{dplyr}</code> functions we have seen so far, we can manipulate our data quite easily and quickly. However, it might be confusing what some functions do, especially when a longer pipeline (i.e., multiple pipe operators) is used, such as the below example. If we want to better understand, we could run the code line for line and view the data frame to get a better understanding. However, external tools are also available to help us.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># Extensive pipeline</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>    <span class="co"># Arrange for grouping</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>    <span class="fu">arrange</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>    <span class="co"># Group on sex</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>    <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7"></a>    <span class="co"># Create new variable BMI based on mass and height</span></span>
<span id="cb29-8"><a href="#cb29-8"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> mass <span class="sc">/</span> (height <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-9"><a href="#cb29-9"></a>    <span class="co"># Drop individuals with missing BMI</span></span>
<span id="cb29-10"><a href="#cb29-10"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bmi))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="tidy-data-tutor" class="level3">
<h3 class="anchored" data-anchor-id="tidy-data-tutor">Tidy data tutor</h3>
<p>With <a href="https://tidydatatutor.com">tidy data tutor</a>, we can run your pipeline on data that can be loaded into R from packages, such as <code>starwars</code> from <code>{dplyr}</code>, and visualize what happens at each pipe operator. We can simply paste the pipeline and load in available data and run it to get a visualization. An example for the above code can be found <a href="https://tidydatatutor.com/vis.html#code=library%28dplyr%29%0A%0A%23%20Extensive%20pipeline%0Astarwars%20%25%3E%25%0A%20%20%20%20%23%20Arrange%20for%20grouping%0A%20%20%20%20arrange%28sex%29%20%25%3E%25%0A%20%20%20%20%23%20Group%20on%20sex%0A%20%20%20%20group_by%28sex%29%20%25%3E%25%0A%20%20%20%20%23%20Create%20new%20variable%20BMI%20based%20on%20mass%20and%20height%0A%20%20%20%20mutate%28bmi%20%3D%20mass%20/%20%28height%20/%20100%29%20%5E%202%29%20%25%3E%25%0A%20%20%20%20%23%20Drop%20individuals%20with%20missing%20BMI%0A%20%20%20%20filter%28!is.na%28bmi%29%29&amp;d=2023-07-18&amp;lang=r&amp;v=v1">here</a>.</p>
</section>
<section id="microsoft-datamations" class="level3">
<h3 class="anchored" data-anchor-id="microsoft-datamations">Microsoft datamations</h3>
<p>Another possibliity is <code>{datamations}</code>, which gives us animations of how the pipeline operates. To use <code>{datamations}</code>, you can first install it with:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Install datamations from github</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"microsoft/datamations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, we can write your pipeline as you normally would. Subsequently, we put the whole pipeline between apostrophes to turn it into a string and use <code>datamation_sanddance()</code> to generate the animation:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="st">"# Pipeline</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="st">starwars %&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="st">    # Remove hermaphroditic sex as this gives a large outlier</span></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="st">    filter(sex != 'hermaphroditic') %&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="st">    # Calculate BMI</span></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="st">    mutate(bmi =mass / (height / 100) ^ 2) %&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="st">     # Group on sex</span></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="st">    group_by(sex) %&gt;%</span></span>
<span id="cb31-9"><a href="#cb31-9"></a><span class="st">    # Get mean BMI per group</span></span>
<span id="cb31-10"><a href="#cb31-10"></a><span class="st">    summarise(mean_bmi = mean(bmi))"</span> <span class="sc">%&gt;%</span> </span>
<span id="cb31-11"><a href="#cb31-11"></a>    <span class="co"># Get animation</span></span>
<span id="cb31-12"><a href="#cb31-12"></a>    <span class="fu">datamation_sanddance</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that <code>{datamations}</code> cannot use every <code>{dplyr}</code> function however. More information on <code>{datamations}</code> can be found <a href="https://github.com/microsoft/datamations">here</a>.</p>
</section>
</section>
<section id="other-useful-functions" class="level2">
<h2 class="anchored" data-anchor-id="other-useful-functions">Other useful functions</h2>
<p>We now discussed some of the most useful functions in <code>{dplyr}</code>, but there are other useful functions available. This list is not meant to make you remember everything, but more so to introduce you to them once, so that you might recognize when you are trying to perform an operation for which <code>{dplyr}</code> has an efficient implementation. Moreover, this list is not exhaustive, but just a selection of useful functions; for everything available in <code>{dplyr}</code>, see <a href="https://www.rdocumentation.org/packages/dplyr/versions/1.0.10">here</a>.</p>
<section id="selecting-parts-of-our-data" class="level3">
<h3 class="anchored" data-anchor-id="selecting-parts-of-our-data">Selecting parts of our data</h3>
<ul>
<li><p><code>pull()</code>: we can extract a single column with <code>pull()</code>, which is similar to subsetting with the <code>$</code> operator.</p></li>
<li><p><code>pick()</code>: if we are inside a function such as <code>mutate()</code> or <code>summarise()</code>, we can use <code>pick()</code> to subset multiple columns.</p></li>
<li><p><code>slice_sample()</code>: select random rows. This is especially useful if you have a rather large data set and first want to test your code on a random subset of your data before running it on the complete data, which might take longer.</p></li>
<li><p><code>distinct()</code>: keep only one row per unique combination of columns supplied to the function. This function drops all columns not specified, unless <code>.keep_all = TRUE</code>.</p></li>
</ul>
</section>
<section id="getting-information-on-and-in-our-data" class="level3">
<h3 class="anchored" data-anchor-id="getting-information-on-and-in-our-data">Getting information on and in our data</h3>
<ul>
<li><p><code>lag()</code>: take a column’s value from the previous row (will be <code>NA</code> for the first row).</p></li>
<li><p><code>lead()</code>: take a column’s value from the next row (will be <code>NA</code> for the last row).</p></li>
<li><p><code>first()</code>, <code>last()</code>, and <code>nth()</code>: take the first, last, or nth (can be specified in the function) value in a column.</p></li>
<li><p><code>n_distinct()</code>: count the total number of unique values.</p></li>
<li><p><code>glimpse()</code>: get a quick glimpse of your data, similar to pressing on the blue button in front of the data in the global environment.</p></li>
</ul>
</section>
<section id="manipulating-our-data" class="level3">
<h3 class="anchored" data-anchor-id="manipulating-our-data">Manipulating our data</h3>
<ul>
<li><p><code>rows()</code>: perform row-based modifications on a data frame using information in another data frame. See <code>?rows</code> for a detailed explanation.</p></li>
<li><p><code>bind_rows()</code>: add data frames together based on rows. This is a more efficient implementation of <code>rbind()</code> and does not require the different data frames to all have the same columns (the final data frame will have all columns of the individual data frames that are bound).</p></li>
<li><p><code>bind_cols()</code>: similar to <code>bind_rows()</code> but for columns, improving on <code>cbind()</code>.</p></li>
<li><p><code>rowwise()</code>: perform a function per row in the data. This is useful when a vectorized function (i.e., a function that operates over the entire vector) is not available. For more detailed explanation, see <code>?rowwise</code>.</p></li>
<li><p><code>na_if()</code>: replace a certain value <code>y</code> in vector <code>x</code> with <code>NA</code>.</p></li>
<li><p><code>if_else()</code>: an improved version of <code>ifelse()</code> that can also take into account missings.</p></li>
</ul>
</section>
</section>
<section id="extensions" class="level2">
<h2 class="anchored" data-anchor-id="extensions">Extensions</h2>
<section id="dtplyr" class="level3">
<h3 class="anchored" data-anchor-id="dtplyr"><code>{dtplyr}</code></h3>
<p><code>{data.table}</code> is a package that works with data frames at a much higher speed than other R packages. Although <code>{data.table}</code> is discussed in more detail in <a href="datatable.qmd">another section</a>, here we shortly discuss the <code>{dplyr}</code> integration with <code>{data.table}</code>.</p>
<p>We can use <code>lazy_dt()</code> to create a data table that tracks any operations and then transform it using <code>as.data.table()</code>, <code>as.data.frame()</code>, or <code>as_tibble()</code>.</p>
<p>Although <code>{dtplyr}</code> is not as fast as <code>{data.table}</code>, it does allow using the readable <code>{dplyr}</code> while approaching the speed of <code>{data.table}</code>.</p>
</section>
<section id="dbplyr" class="level3">
<h3 class="anchored" data-anchor-id="dbplyr"><code>{dbplyr}</code></h3>
<p>Sometimes, our data is not stored locally but in a remote database, such as SQL. In that case, you can use <code>{dbplyr}</code> to manipulate the data as if it were in-memory using <code>{dplyr}</code> functionality.</p>
<p>Using the <code>dbConnect()</code> from <code>{DBI}</code>, we can connect a data base from SQL to an object in R and then manipulate it. Behind the scenes, your R code is translated into SQL code. To get started, you can look up the vignette (<code>vignette(sql)</code>) or see <a href="https://dbplyr.tidyverse.org/">here</a> and <a href="https://dbplyr.tidyverse.org/articles/sql.html">here</a>.</p>
</section>
<section id="sparklyr" class="level3">
<h3 class="anchored" data-anchor-id="sparklyr"><code>{sparklyr}</code></h3>
<p>Apache Spark is a powerful framework for processing data quickly and efficiently. It is popular due to it’s speed with big data. Although not officially a <code>{dplyr}</code> extension, <code>{dplyr}</code> and other R code can be used to access Apache Spark through <code>{sparklyr}</code>. You can find more information <a href="https://spark.rstudio.com/">here</a>.</p>
</section>
</section>
<section id="wrapping-up" class="level2">
<h2 class="anchored" data-anchor-id="wrapping-up">Wrapping up</h2>
<p>We now saw the majority of functions that <code>{dplyr}</code> offers us to manipulate our data into taking the shape we want it to take. If you ever want to have a quick look at what functions are available again, without the explanations in this tutorial, you can check out the <a href="https://dplyr.tidyverse.org/reference/index.html"><code>{dplyr}</code> reference guide</a> or the <a href="https://www.rdocumentation.org/packages/dplyr/versions/1.0.10">documentation</a>.</p>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<section id="subset-data" class="level3">
<h3 class="anchored" data-anchor-id="subset-data">1. Subset data</h3>
<p>From the data <code>mtcars</code>, keep only cars with a weight (<code>wt</code>) of 3 or higher and store this into an object <code>dat</code></p>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">filter</span>(mtcars, wt <span class="sc">&gt;=</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="create-weight-category" class="level3">
<h3 class="anchored" data-anchor-id="create-weight-category">2. Create weight category</h3>
<p>Create a column <code>wt_cat</code> categorizing <code>wt</code> into smaller than 4 (0) and 4 or greater (1) in <code>dat</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Solution 1: using ifelse</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>dat <span class="ot">&lt;-</span> <span class="fu">mutate</span>(dat, <span class="at">wt_cat =</span> <span class="fu">ifelse</span>(wt <span class="sc">&lt;</span> <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb33-3"><a href="#cb33-3"></a></span>
<span id="cb33-4"><a href="#cb33-4"></a><span class="co"># Solution 2: using if_else</span></span>
<span id="cb33-5"><a href="#cb33-5"></a>dat <span class="ot">&lt;-</span> <span class="fu">mutate</span>(dat, <span class="at">wt_cat =</span> <span class="fu">if_else</span>(wt <span class="sc">&lt;</span> <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb33-6"><a href="#cb33-6"></a></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="co"># Solution 3: using case_when</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>dat <span class="ot">&lt;-</span> <span class="fu">mutate</span>(dat, <span class="at">wt_cat =</span> <span class="fu">case_when</span>(wt <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="dv">0</span>, <span class="at">.default =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="drop-columns" class="level3">
<h3 class="anchored" data-anchor-id="drop-columns">3. Drop columns</h3>
<p>Remove the <code>hp</code> and <code>vs</code> columns from <code>dat</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">select</span>(dat, <span class="sc">-</span><span class="fu">c</span>(hp, vs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="get-group-statistics" class="level3">
<h3 class="anchored" data-anchor-id="get-group-statistics">4. Get group statistics</h3>
<p>Determine the number of cars for each level of <code>cyl</code></p>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Solution 1: using group_by and summarise</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>dat <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>    <span class="co"># Arrange data for grouping</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>    <span class="fu">arrange</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb35-5"><a href="#cb35-5"></a>    <span class="co"># Group per level of cylinders</span></span>
<span id="cb35-6"><a href="#cb35-6"></a>    <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb35-7"><a href="#cb35-7"></a>    <span class="co"># Get count per level of cylinders</span></span>
<span id="cb35-8"><a href="#cb35-8"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
    cyl     n
  &lt;dbl&gt; &lt;int&gt;
1     4     2
2     6     4
3     8    14</code></pre>
</div>
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># Solution 2: using group_by and tally</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>dat <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3"></a>    <span class="co"># Arrange for grouping</span></span>
<span id="cb37-4"><a href="#cb37-4"></a>    <span class="fu">arrange</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5"></a>    <span class="co"># Group per level of cylinders</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>    <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="#cb37-7"></a>    <span class="co"># Tally per group of cylinders</span></span>
<span id="cb37-8"><a href="#cb37-8"></a>    <span class="fu">tally</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
    cyl     n
  &lt;dbl&gt; &lt;int&gt;
1     4     2
2     6     4
3     8    14</code></pre>
</div>
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># Solution 3: using count</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>dat <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>    <span class="co"># Arrange for grouping</span></span>
<span id="cb39-4"><a href="#cb39-4"></a>    <span class="fu">arrange</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5"></a>    <span class="co"># Count per group of cylinders</span></span>
<span id="cb39-6"><a href="#cb39-6"></a>    <span class="fu">count</span>(cyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  cyl  n
1   4  2
2   6  4
3   8 14</code></pre>
</div>
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># Solution 4: using gropu_by and mutate</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>dat <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>    <span class="co"># Arrange for grouping</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>    <span class="fu">arrange</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>    <span class="co"># Group per level of cylinders</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>    <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb41-7"><a href="#cb41-7"></a>    <span class="co"># Per group, calculate number of cylinders</span></span>
<span id="cb41-8"><a href="#cb41-8"></a>    <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb41-9"><a href="#cb41-9"></a>    <span class="co"># Per group, keep one row</span></span>
<span id="cb41-10"><a href="#cb41-10"></a>    <span class="fu">slice</span>(<span class="dv">1</span>L) <span class="sc">%&gt;%</span></span>
<span id="cb41-11"><a href="#cb41-11"></a>    <span class="co"># Ungroup again</span></span>
<span id="cb41-12"><a href="#cb41-12"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-13"><a href="#cb41-13"></a>    <span class="co"># Keep only relevant columns</span></span>
<span id="cb41-14"><a href="#cb41-14"></a>    <span class="fu">select</span>(cyl, n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
    cyl     n
  &lt;dbl&gt; &lt;int&gt;
1     4     2
2     6     4
3     8    14</code></pre>
</div>
</div>
</section>
<section id="put-it-all-in-a-pipeline" class="level3">
<h3 class="anchored" data-anchor-id="put-it-all-in-a-pipeline">5. Put it all in a pipeline</h3>
<p>Now perform exercises 1 through 4 but use one continuous pipeline</p>
<div class="cell">
<details class="code-fold">
<summary>Answer</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># You can combine any of the solutions of exercise 1 through 4, here I show just one:</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>dat <span class="ot">&lt;-</span> mtcars <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3"></a>    <span class="co"># Keep only cars with weight &gt;= 3</span></span>
<span id="cb43-4"><a href="#cb43-4"></a>    <span class="fu">filter</span>(wt <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5"></a>    <span class="co"># Create category for weight</span></span>
<span id="cb43-6"><a href="#cb43-6"></a>    <span class="fu">mutate</span>(<span class="at">wt_cat =</span> <span class="fu">ifelse</span>(wt <span class="sc">&lt;</span> <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-7"><a href="#cb43-7"></a>    <span class="co"># Remove columns hp and vs</span></span>
<span id="cb43-8"><a href="#cb43-8"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(hp, vs)) <span class="sc">%&gt;%</span></span>
<span id="cb43-9"><a href="#cb43-9"></a>    <span class="co"># Arrange for grouping</span></span>
<span id="cb43-10"><a href="#cb43-10"></a>    <span class="fu">arrange</span>(cyl) <span class="sc">%&gt;%</span></span>
<span id="cb43-11"><a href="#cb43-11"></a>    <span class="co"># Count per group of cylinders</span></span>
<span id="cb43-12"><a href="#cb43-12"></a>    <span class="fu">count</span>(cyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="next-topic" class="level2">
<h2 class="anchored" data-anchor-id="next-topic">Next topic</h2>
<p>Now that we know the grammar of <code>{dplyr}</code>, we can see how <code>{tidyr}</code> assists us if the data we want to manipulate is not quite tidy enough yet.</p>
<p><strong>Next:</strong> <a href="tidyr.qmd">Tidyr</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>