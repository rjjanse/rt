---
title: "Packages"
---

## Packages
We now know how we can access our data and manipulate it. However, everything that we saw until now is by default available in R. Nonetheless, we cannot expect the maintainers of R (the R Core Team) to implement every idea, optimalization, and statistical method. This is where packages come in.

Packages are libraries of functions created by other people implementing certain methods, ideas, and optimalizations. These packages allow us to implement certain methods, perform certain analyses, and improve our code, without having to program this all ourselves.

## Pre-installed packages
Some packages come pre-installed with R. For example, `sum()` comes from the `base` package, while `sd()` comes from the `stats` package. We can see the currently installed packages in RStudio in the lower right window in the tab 'packages', as seen in @fig-packages. Mind you that in @fig-packages, there might be different packages than in your window, depending on what packages are already or not yet installed.

In @fig-packages, you can see a checkbox, which indicates whether a package is loaded (more on that in a few lines), the package name, a description, a version, and buttons to the homepage, and an option to remove the package.

![Installed packages](images/packages.png){#fig-packages fig-alt="Installed packages" fig-align="center" height=70%}

If we want to check out what a package does, we can ask for help on a package in the same way as we ask for help on a function:
```r
?stats
```

We could also open an extensive overview of a package's details using `library()`:
```r
library(help = "stats")
```
This overview shows us not only detailed information on the package, but also the functions the package supplies.

:::{.callout-tip appearance="simple"}
When we talk about packages, for example when asking a question on stack overflow, packages can be denoted with curly brackets. For instance, the base package could be called `{base}`.
:::

## Installing packages
Although the pre-installed packages give us a lot of functionality, we might still want more. Yes, with `{stats}` we can do a linear regression, but not Cox regression. If we want to perform a Cox regression, we could use the `{survival}` package. To install it, we can use the below code. You might be prompted to pick a mirror for installation, which basically just means: 'choose a website identical to the original download website, but with a different server'. This way, you can pick a server in your own country increasing download speeds.

```r
install.packages("survival")
```

:::{.column-margin}
When packages are installed, they will always give the message `MD5 sums checked`. MD5 is an algorithm that can help identify unintentional data/file corruption ([more](https://en.wikipedia.org/wiki/MD5)).
:::

When we install a package, the package is downloaded from the Comprehensive R Archive Network (CRAN), which is the same place where you also downloaded R itself.

### R tools
Sometimes you might get an error message when installing a package, which indicates that you need a program called RTools to install the package. To resolve this error, you can install RTools from [CRAN](https://cran.r-project.org/bin/windows/Rtools/).

### Package versions
Packages have two versions: the version of the package and the version of R for which they were build. The package version simply indicates the progress of development of that package, but the version of R for which the package was built is more important. There can be three cases: 

- The package is built for your current version of R: there will be no problem.

- The package is built for a newer version of R: you will receive a warning, but other than that, this will not be a problem.

- The package is built for an older version of R: you cannot use the package with your current version of R. You can look if there is another package which offers the same functionalities or, less ideally, switch back to an older version of R.

### Installing from GitHub
Sometimes, packages do not exist on CRAN yet; the package might not be fully ready yet or still be edited frequently. In such a case, you could install a package from GitHub. To do this, first you need to install `{devtools}`:

```r
install.packages("devtools")
```

From `{devtools}`, we can use the `install_github()` function to install a package. For instance, if we wanted to install `{KMunicate}` from GitHub, we could run:

```r
install_github("ellessenne/KMunicate-package")
```

where `ellessenne` is the GitHub user's username and `KMunicate-package` the repository of the package.

## Loading packages
The good thing about installing packages is that we only have to install them once on our device. Once they are installed, at the beginning of your R session, you can load them in using `library()`. If we wanted to load `{survival}` after installing it previously, we can do:

```r
library("survival")
```

We could also load multiple packages at once with `library()`:

```r
library("survival", "stats")
```

The help function for `library()` shows that there is also a function called `require()`. In general, this works similar to `library()` but is used more often within functions. Whereas `library()` will return an error if the package is not installed, `require()` will only give a warning.

### Masking
Sometimes, we may get the warning that certain functions become masked:

```{r}
#| code-fold: false
# Install dplyr
install.packages("dplyr")

# Load dplyr
library("dplyr")

```

Loading the package `{dplyr}` caused, among others, the function `filter()` from `{stats}` to be masked. This means that if we call `filter()`, we will call the function from `{dplyr}`, not from `{stats}`, which might have a different functionality. If we still want to use `filter()` from `{stats}`, we can prespecify the package with a double colon `::`:

```r
stats::filter()
```

:::{.callout-tip appearance="simple"}
In general, we can call functions from installed packages without loading the package, by using `::`. Without loading `{survival}`, we can still call `survival::coxph()`, so long as `{survival}` is installed.
:::

### Pacman
It can be a hassle to first install packages and then load them with library. By using the package `{pacman}`, we can simplify this process. We only need to install it once on our device and after that we load any package with:

```r
pacman::p_load("survival", "dplyr")

```

`{pacman}` will first check if a package is installed. If it is not, the package will first be installed from CRAN and then loaded, otherwise it will just be loaded. By calling the function `p_load()` immediately from `{pacman}` with `::`, we do not need to load `{pacman}` first.

Note that `{pacman}` does not tell you whether a function becomes masked.

### Annotating package loading
Although we might know why we load certain packages, another person reading our code might not. Therefore, it is good practice to annotate for what reason we load certain packages. For example, you can annotate package loading as such:

```r
# Load packages
pacman::p_load("dplyr",         # Data manipulation
               "tidyr",         # Pivoting data
               "magrittr",      # Efficient pipe structures
               "stringr",       # Better regexing
               "mice",          # Multiple imputation
               "summarytools",  # Summarizing data frames
               "haven"          # Load SPSS data
)
```

## Updating packages

## Uninstalling packages

## A warning

### Dependencies

### Trust

## Exercises

## Next topic