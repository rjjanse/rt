<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Plotting</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./plotting.html">New skills</a></li><li class="breadcrumb-item"><a href="./plotting.html">Plotting</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Start</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Set-up</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RStudio</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">The basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./creating.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./using.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Into the tidyverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tidyverse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dplyr</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tidyr</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./magrittr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Magrittr</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">New skills</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./plotting.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Plotting</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">random.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">functions.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">looping.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">iterating.qmd</span>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regex</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Workflow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">scripts.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">rmarkdown.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Parts of a paper</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
 <span class="menu-text">regression.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">table1.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">imputation.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">confounding.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">prediction.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">competing_risks.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Into the multiverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datatable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">data.table</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">shiny.qmd</span>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Recap</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
 <span class="menu-text">rython.qmd</span>
  </li>
          <li class="sidebar-item">
 <span class="menu-text">slow.qmd</span>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#plotting-in-r" id="toc-plotting-in-r" class="nav-link active" data-scroll-target="#plotting-in-r">Plotting in R</a></li>
  <li><a href="#ggplot2" id="toc-ggplot2" class="nav-link" data-scroll-target="#ggplot2"><code>{ggplot2}</code></a>
  <ul>
  <li><a href="#layer-1-the-data" id="toc-layer-1-the-data" class="nav-link" data-scroll-target="#layer-1-the-data">Layer 1: the data</a></li>
  <li><a href="#layer-2-the-geometries" id="toc-layer-2-the-geometries" class="nav-link" data-scroll-target="#layer-2-the-geometries">Layer 2: the geometries</a></li>
  <li><a href="#layer-3-the-scaling" id="toc-layer-3-the-scaling" class="nav-link" data-scroll-target="#layer-3-the-scaling">Layer 3: the scaling</a>
  <ul class="collapse">
  <li><a href="#axes" id="toc-axes" class="nav-link" data-scroll-target="#axes">Axes</a></li>
  <li><a href="#aesthetics" id="toc-aesthetics" class="nav-link" data-scroll-target="#aesthetics">Aesthetics</a></li>
  </ul></li>
  <li><a href="#layer-4-labels" id="toc-layer-4-labels" class="nav-link" data-scroll-target="#layer-4-labels">Layer 4: labels</a></li>
  <li><a href="#layer-5-coordinates-and-transformations" id="toc-layer-5-coordinates-and-transformations" class="nav-link" data-scroll-target="#layer-5-coordinates-and-transformations">Layer 5: coordinates and transformations</a>
  <ul class="collapse">
  <li><a href="#coord_cartesian" id="toc-coord_cartesian" class="nav-link" data-scroll-target="#coord_cartesian"><code>coord_cartesian()</code></a></li>
  <li><a href="#facet_grid-and-facet_panel" id="toc-facet_grid-and-facet_panel" class="nav-link" data-scroll-target="#facet_grid-and-facet_panel"><code>facet_grid()</code> and <code>facet_panel()</code></a></li>
  </ul></li>
  <li><a href="#layer-6-theme" id="toc-layer-6-theme" class="nav-link" data-scroll-target="#layer-6-theme">Layer 6: theme</a></li>
  <li><a href="#common-errors" id="toc-common-errors" class="nav-link" data-scroll-target="#common-errors">Common errors</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./plotting.html">New skills</a></li><li class="breadcrumb-item"><a href="./plotting.html">Plotting</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Plotting</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="plotting-in-r" class="level2">
<h2 class="anchored" data-anchor-id="plotting-in-r">Plotting in R</h2>
<p>A lot of analyses are represented by figures in the final papers. Additionally, visualization of data may allow better scrutiny of data patterns. As such, creating figures in R, or ‘plotting’ (because we are making plots).</p>
<p>The way plots are created varies, but two large methods stand out. The first we will discuss is implemented by the <code>{ggplot2}</code> package. This package is based on the grammar of graphics, a landmark work on statistical graphics (ergo ‘gg’ for ‘grammr of graphics’). The second method we will discuss is the base R plotting, which is part of the R <code>{graphics}</code> package.</p>
<p>As example data, we will use the package <code>{palmerpenguins}</code>, which contains data on 344 penguins from three islands in the Palmer Archipelago, Antarctica (more <a href="https://allisonhorst.github.io/palmerpenguins/">here</a>).</p>
<p>We will also load the <code>{ggplot2}</code> package. The <code>{graphics}</code> package is installed and loaded by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(<span class="st">"ggplot2"</span>,          <span class="co"># Data visualization</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>               <span class="st">"palmerpenguins"</span>    <span class="co"># Example data</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>               )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="ggplot2"><code>{ggplot2}</code></h2>
<p>Basically, the grammar of graphics provides a foundation that describes how any statistical graphic can be build up, which is based on layers. This layered system gives rise to how the package <code>{ggplot2}</code> allows us to create figures (i.e.&nbsp;plots).</p>
<section id="layer-1-the-data" class="level3">
<h3 class="anchored" data-anchor-id="layer-1-the-data">Layer 1: the data</h3>
<p>The first layer we specify is the data layer. In this layer, we specify our data and the mapping of the aesthetics, meaning we define what our x-axis will portray, the y-axis, what colours, etc. will portray. This first layer is called using <code>ggplot()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here, we specified the first argument (<code>data = penguins</code>) to be our dataset. For the second argument (<code>mapping = aes()</code>), we supply a function: <code>aes()</code>. This function allows us to specify what will make up the aesthetics of the graph: the x-axis will be ‘body_mass_g’ and the y-axis will be ‘flipper_length_mm’. Because we did not supply any other layer, we can see that the figure remains largely empty, only having some automatically set limits and titles for the axes.</p>
</section>
<section id="layer-2-the-geometries" class="level3">
<h3 class="anchored" data-anchor-id="layer-2-the-geometries">Layer 2: the geometries</h3>
<p>Now we can add the geometries. We are offered a large number of geometries by <code>{ggplot2}</code>, with some basics including points, lines, bars, histograms, rectangles, segments, steps, and ribbons. Each geometry is called by a <code>geom_...()</code> function, such as <code>geom_point()</code> and <code>geom_line()</code>.</p>
<p>For our figure, we will add points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm)) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>You may notice that layers in these plots are added together by using a plus (<code>+</code>) sign. Additionally, the warning you is just <code>{ggplot2}</code> telling you there were some <code>NA</code>’s that could not be drawn in the plot. Note that this error is also given if you have some values that are outside of the boundaries of your plot.</p>
<p>Within each geometry, we can edit many things, such as the colour, fill (i.e.&nbsp;the colour of shapes that contain an inside), size, alpha (i.e.&nbsp;transparency), and shape (or linetype for lines). Much more is possible, but can be learned from the help functions for each geometry.</p>
<p>Note that any geometry is applied in subsequent order. If we add a trendline (<code>geom_smooth(method = "lm", formula = "y ~ x")</code>), this will be drawn on top of the points if we specify it after <code>geom_point()</code> or before if we specify it before <code>geom_point()</code>.</p>
<p>Let’s do this now:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm)) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">colour =</span> <span class="st">"#B58900"</span>, <span class="at">fill =</span> <span class="st">"#B58900"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We specified point shape as a number, for which you can find <a href="http://www.sthda.com/english/wiki/ggplot2-point-shapes">online</a> what different numbers mean. We specified the colour as a hex code, but you can also use the <code>rgb()</code> function for RGB specification, or English language for a number of colours that can be found <a href="https://r-charts.com/colors/">here</a>. Lastly, we specify the British English colour instead of the American English color. <code>{ggplot2}</code> will accept both, for arguments and for functions (e.g.&nbsp;<code>scale_color_manual()</code> and <code>scale_colour_manual()</code> both exist and do the same thing). We will revert the points back to their default for the remainder of the plot.</p>
</section>
<section id="layer-3-the-scaling" class="level3">
<h3 class="anchored" data-anchor-id="layer-3-the-scaling">Layer 3: the scaling</h3>
<p>For the third layer, we will apply scaling, which means we will edit anything that can be a scale (e.g.&nbsp;axes, colours, fill).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that we deviate from the grammar of graphics in building our plot. The order in which we specify our layers does not adhere to the grammar of graphics. Luckily, in the background, <code>{ggplot2}</code> ignores this, only keeping the order in which we called geometries for geometries, but for instance not drawing theming prior to geometries, even if we specify so.</p>
</div>
</div>
<section id="axes" class="level4">
<h4 class="anchored" data-anchor-id="axes">Axes</h4>
<p>In our current plot, we have two scales: the x-axis and y-axis. We can edit these using scale functions that concur with the scale type (i.e.&nbsp;continuous, discrete, etc.). In our case, both scales are continuous, so we will use <code>scale_x_continuous()</code> and <code>scale_y_continuous()</code>. For other types of scales, we might also use <code>scale_x_discrete()</code>, <code>scale_x_date()</code>, etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm)) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">colour =</span> <span class="st">"#B58900"</span>, <span class="at">fill =</span> <span class="st">"#B58900"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="co"># Scaling</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb8-7"><a href="#cb8-7"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2500</span>, <span class="dv">6500</span>),</span>
<span id="cb8-8"><a href="#cb8-8"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>),</span>
<span id="cb8-9"><a href="#cb8-9"></a>                       <span class="at">labels =</span> <span class="fu">prettyNum</span>(<span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>), <span class="at">big.mark =</span> <span class="st">","</span>)) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Flipper length (millimeters)"</span>,</span>
<span id="cb8-11"><a href="#cb8-11"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">240</span>),</span>
<span id="cb8-12"><a href="#cb8-12"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">170</span>, <span class="dv">240</span>, <span class="dv">10</span>))                     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the scale functions, we can give the name of the axis, the limits of the axis, at which points there should be ticks (<code>breaks</code>), and the labels given to each tick.</p>
<p>One more thing we can do in the scale functions is determine the expansion. By default, <code>{ggplot2}</code> expands the axes a bit so that the figure does not seem too cropped. Sometimes, however, we might want to remove or change this. If we want to remove this, we can use <code>expand = c(0, 0)</code> in the scaling arguments for each axis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm)) <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">colour =</span> <span class="st">"#B58900"</span>, <span class="at">fill =</span> <span class="st">"#B58900"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="co"># Scaling</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb11-7"><a href="#cb11-7"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2500</span>, <span class="dv">6500</span>),</span>
<span id="cb11-8"><a href="#cb11-8"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>),</span>
<span id="cb11-9"><a href="#cb11-9"></a>                       <span class="at">labels =</span> <span class="fu">prettyNum</span>(<span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb11-10"><a href="#cb11-10"></a>                       <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Flipper length (millimeters)"</span>,</span>
<span id="cb11-12"><a href="#cb11-12"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">240</span>),</span>
<span id="cb11-13"><a href="#cb11-13"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">170</span>, <span class="dv">240</span>, <span class="dv">10</span>))                     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Above we only removed the expansion for the y-axis. We can also change the amount of expansion (by addition or multiplication) by supplying the <code>expansion()</code> function to the <code>expand =</code> argument. We will leave the expansion to its default again while working on our example.</p>
</section>
<section id="aesthetics" class="level4">
<h4 class="anchored" data-anchor-id="aesthetics">Aesthetics</h4>
<p>Besides scaling the axes, we can also specify specific scales of our plot. Before we do that, let’s go through the different scales we can define in <code>aes()</code>:</p>
<ul>
<li><code>colour</code> (or <code>color</code>): this defines the colour of all geometries. For geometries with an inside area, <code>colour</code> will only colour the outside/circumference.</li>
<li><code>fill</code>: this defines the colour of the inside of all geometries.</li>
<li><code>linetype</code>: for any geometry that draws a line, this defines the linetype.</li>
<li><code>size</code>: this determines the line of certain geometries, such as points.</li>
</ul>
<p>There are a number of other scales, but these are the most important to understand the basics.</p>
<p>Let’s stratify the plots by island. To do this, we can specify that colour, fill, and linetype should be different for the different levels of <code>island</code>. We can do this in the <code>aes()</code> function. Note that we will remove the <code>colour</code> and <code>fill</code> specification in <code>geom_smooth()</code> as these are now specified in <code>aes()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">colour =</span> island, <span class="at">fill =</span> island, <span class="at">linetype =</span> island)) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, , <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>    <span class="co"># Scaling</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb14-7"><a href="#cb14-7"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2500</span>, <span class="dv">6500</span>),</span>
<span id="cb14-8"><a href="#cb14-8"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>),</span>
<span id="cb14-9"><a href="#cb14-9"></a>                       <span class="at">labels =</span> <span class="fu">prettyNum</span>(<span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb14-10"><a href="#cb14-10"></a>                       <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Flipper length (millimeters)"</span>,</span>
<span id="cb14-12"><a href="#cb14-12"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">240</span>),</span>
<span id="cb14-13"><a href="#cb14-13"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">170</span>, <span class="dv">240</span>, <span class="dv">10</span>))                     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As you can see, <code>{ggplot2}</code> automatically selected colours for us, as well as create a legend, and perform any statistical operations (such as the LOESS smoother) within groups.</p>
<p>Now we can use scales to change these scales to our preferences:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">colour =</span> island, <span class="at">fill =</span> island, <span class="at">linetype =</span> island)) <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, , <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>    <span class="co"># Scaling</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb17-7"><a href="#cb17-7"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2500</span>, <span class="dv">6500</span>),</span>
<span id="cb17-8"><a href="#cb17-8"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>),</span>
<span id="cb17-9"><a href="#cb17-9"></a>                       <span class="at">labels =</span> <span class="fu">prettyNum</span>(<span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb17-10"><a href="#cb17-10"></a>                       <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Flipper length (millimeters)"</span>,</span>
<span id="cb17-12"><a href="#cb17-12"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">240</span>),</span>
<span id="cb17-13"><a href="#cb17-13"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">170</span>, <span class="dv">240</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkorange"</span>, <span class="st">"purple"</span>, <span class="st">"cyan4"</span>), <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"colour"</span>, <span class="st">"fill"</span>)) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>))                    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that we specify <code>aesthetics =</code> in the colour scale, which allows us to use one scale for both colour and fill. Of course, we can also separately specify <code>scale_fill_manual()</code>.</p>
<p>There are also implementations of well-known palettes for colours, for instance viridis which is a palette distinguishable also for people with the most common types of colourblindness:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">colour =</span> island, <span class="at">fill =</span> island, <span class="at">linetype =</span> island)) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, , <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>    <span class="co"># Scaling</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb20-7"><a href="#cb20-7"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2500</span>, <span class="dv">6500</span>),</span>
<span id="cb20-8"><a href="#cb20-8"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>),</span>
<span id="cb20-9"><a href="#cb20-9"></a>                       <span class="at">labels =</span> <span class="fu">prettyNum</span>(<span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb20-10"><a href="#cb20-10"></a>                       <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Flipper length (millimeters)"</span>,</span>
<span id="cb20-12"><a href="#cb20-12"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">240</span>),</span>
<span id="cb20-13"><a href="#cb20-13"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">170</span>, <span class="dv">240</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14"></a>    <span class="fu">scale_colour_viridis_d</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"fill"</span>, <span class="st">"colour"</span>)) <span class="sc">+</span></span>
<span id="cb20-15"><a href="#cb20-15"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>))                    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Linetypes can again be specified as numbers or text, for which a guide can be found <a href="https://r-charts.com/base-r/line-types/">here</a>.</p>
</section>
</section>
<section id="layer-4-labels" class="level3">
<h3 class="anchored" data-anchor-id="layer-4-labels">Layer 4: labels</h3>
<p>In the next layer, we will apply labels to the plot, which includes the title, subtitle, axes labels, and legends.</p>
<p>For the axes labels, we can use <code>xlab()</code> and <code>ylab()</code> respectively. We won’t need these as we specified the name already in the scaling function, but they might be useful if you do not need the scale function. The title can be specified using the <code>ggtitle()</code> function, which also allows you to specify a subtitle. Alternatively, this can be done through the <code>labs()</code> function, which allows much more control, such as a tag (for multipanel labels where you want to tag A, B, C, etc.), a caption, and alt text (for accessibility purposes).</p>
<p>For the plot we’re building, we will aply a title and a subtitle.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">colour =</span> island, <span class="at">fill =</span> island, <span class="at">linetype =</span> island)) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, , <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>    <span class="co"># Scaling</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb23-7"><a href="#cb23-7"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2500</span>, <span class="dv">6500</span>),</span>
<span id="cb23-8"><a href="#cb23-8"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>),</span>
<span id="cb23-9"><a href="#cb23-9"></a>                       <span class="at">labels =</span> <span class="fu">prettyNum</span>(<span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb23-10"><a href="#cb23-10"></a>                       <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Flipper length (millimeters)"</span>,</span>
<span id="cb23-12"><a href="#cb23-12"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">240</span>),</span>
<span id="cb23-13"><a href="#cb23-13"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">170</span>, <span class="dv">240</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb23-14"><a href="#cb23-14"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkorange"</span>, <span class="st">"purple"</span>, <span class="st">"cyan4"</span>), <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"colour"</span>, <span class="st">"fill"</span>)) <span class="sc">+</span></span>
<span id="cb23-15"><a href="#cb23-15"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>))  <span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16"></a>    <span class="co"># Labels</span></span>
<span id="cb23-17"><a href="#cb23-17"></a>    <span class="fu">ggtitle</span>(<span class="st">"Relation between penguin body mass and flipper length"</span>, </span>
<span id="cb23-18"><a href="#cb23-18"></a>            <span class="at">subtitle =</span> <span class="st">"Data from the Palmer Archipelago penguins"</span>)                 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Additionally, we can edit the legend by using <code>guide()</code>. <code>guide()</code> let’s us specify details about the legend for each scale that we used. In our case, we used <code>colour</code>, <code>fill</code>, and <code>linetype</code>. Imagine that we wanted to remove the legend for <code>fill</code> (which is combined with <code>linetype</code> and <code>colour</code> because they are based on the same variable), we can simply do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">colour =</span> island, <span class="at">fill =</span> island, <span class="at">linetype =</span> island)) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, , <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>    <span class="co"># Scaling</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb26-7"><a href="#cb26-7"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2500</span>, <span class="dv">6500</span>),</span>
<span id="cb26-8"><a href="#cb26-8"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>),</span>
<span id="cb26-9"><a href="#cb26-9"></a>                       <span class="at">labels =</span> <span class="fu">prettyNum</span>(<span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb26-10"><a href="#cb26-10"></a>                       <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Flipper length (millimeters)"</span>,</span>
<span id="cb26-12"><a href="#cb26-12"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">240</span>),</span>
<span id="cb26-13"><a href="#cb26-13"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">170</span>, <span class="dv">240</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkorange"</span>, <span class="st">"purple"</span>, <span class="st">"cyan4"</span>), <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"colour"</span>, <span class="st">"fill"</span>)) <span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>))  <span class="sc">+</span></span>
<span id="cb26-16"><a href="#cb26-16"></a>    <span class="co"># Labels</span></span>
<span id="cb26-17"><a href="#cb26-17"></a>    <span class="fu">ggtitle</span>(<span class="st">"Relation between penguin body mass and flipper length"</span>, </span>
<span id="cb26-18"><a href="#cb26-18"></a>            <span class="at">subtitle =</span> <span class="st">"Data from the Palmer Archipelago penguins"</span>) <span class="sc">+</span></span>
<span id="cb26-19"><a href="#cb26-19"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>)             </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Additionally, we can specify that we want the legend to take a different form (e.g.&nbsp;colourbar). We can also further modify the legend with <code>guide_legend()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">colour =</span> island, <span class="at">fill =</span> island, <span class="at">linetype =</span> island)) <span class="sc">+</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, , <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>    <span class="co"># Scaling</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb29-7"><a href="#cb29-7"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2500</span>, <span class="dv">6500</span>),</span>
<span id="cb29-8"><a href="#cb29-8"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>),</span>
<span id="cb29-9"><a href="#cb29-9"></a>                       <span class="at">labels =</span> <span class="fu">prettyNum</span>(<span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb29-10"><a href="#cb29-10"></a>                       <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Flipper length (millimeters)"</span>,</span>
<span id="cb29-12"><a href="#cb29-12"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">240</span>),</span>
<span id="cb29-13"><a href="#cb29-13"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">170</span>, <span class="dv">240</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkorange"</span>, <span class="st">"purple"</span>, <span class="st">"cyan4"</span>), <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"colour"</span>, <span class="st">"fill"</span>)) <span class="sc">+</span></span>
<span id="cb29-15"><a href="#cb29-15"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>))  <span class="sc">+</span></span>
<span id="cb29-16"><a href="#cb29-16"></a>    <span class="co"># Labels</span></span>
<span id="cb29-17"><a href="#cb29-17"></a>    <span class="fu">ggtitle</span>(<span class="st">"Relation between penguin body mass and flipper length"</span>, </span>
<span id="cb29-18"><a href="#cb29-18"></a>            <span class="at">subtitle =</span> <span class="st">"Data from the Palmer Archipelago penguins"</span>) <span class="sc">+</span></span>
<span id="cb29-19"><a href="#cb29-19"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>,</span>
<span id="cb29-20"><a href="#cb29-20"></a>           <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="st">"bottom"</span>))             </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that we can also specify <code>guide_legend()</code> within scale functions.</p>
</section>
<section id="layer-5-coordinates-and-transformations" class="level3">
<h3 class="anchored" data-anchor-id="layer-5-coordinates-and-transformations">Layer 5: coordinates and transformations</h3>
<section id="coord_cartesian" class="level4">
<h4 class="anchored" data-anchor-id="coord_cartesian"><code>coord_cartesian()</code></h4>
<p>We have already seen that we can limit our axes using the <code>limits</code> argument in the scaling functions. However, if we limit our axis too much, data that falls outside of this range will be removed. If we want to limit the axes without data being removed, we can use the arguments <code>xlim =</code> and <code>ylim =</code> in the function <code>coord_cartesian()</code>. As an example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">colour =</span> island, <span class="at">fill =</span> island, <span class="at">linetype =</span> island)) <span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, , <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5"></a>    <span class="co"># Scaling</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb32-7"><a href="#cb32-7"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2500</span>, <span class="dv">6500</span>),</span>
<span id="cb32-8"><a href="#cb32-8"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>),</span>
<span id="cb32-9"><a href="#cb32-9"></a>                       <span class="at">labels =</span> <span class="fu">prettyNum</span>(<span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb32-10"><a href="#cb32-10"></a>                       <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Flipper length (millimeters)"</span>,</span>
<span id="cb32-12"><a href="#cb32-12"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">240</span>),</span>
<span id="cb32-13"><a href="#cb32-13"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">170</span>, <span class="dv">240</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb32-14"><a href="#cb32-14"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkorange"</span>, <span class="st">"purple"</span>, <span class="st">"cyan4"</span>), <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"colour"</span>, <span class="st">"fill"</span>)) <span class="sc">+</span></span>
<span id="cb32-15"><a href="#cb32-15"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>))  <span class="sc">+</span></span>
<span id="cb32-16"><a href="#cb32-16"></a>    <span class="co"># Labels</span></span>
<span id="cb32-17"><a href="#cb32-17"></a>    <span class="fu">ggtitle</span>(<span class="st">"Relation between penguin body mass and flipper length"</span>, <span class="at">subtitle =</span> <span class="st">"Data from the Palmer Archipelago penguins"</span>) <span class="sc">+</span></span>
<span id="cb32-18"><a href="#cb32-18"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>,</span>
<span id="cb32-19"><a href="#cb32-19"></a>           <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="st">"bottom"</span>)) <span class="sc">+</span></span>
<span id="cb32-20"><a href="#cb32-20"></a>    <span class="co"># Transformations</span></span>
<span id="cb32-21"><a href="#cb32-21"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">3000</span>, <span class="dv">5000</span>))             </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that now the panel is cropped on the x-axis according to <code>coord_cartesian()</code>, but that our data has remained. This is for instance useful when we have some confidence intervals that become very broad but we do not want to show the range of the y-axis over the whole range of the confidence interval. For now, we will leave it out, but it’s good to have it in our toolbox.</p>
</section>
<section id="facet_grid-and-facet_panel" class="level4">
<h4 class="anchored" data-anchor-id="facet_grid-and-facet_panel"><code>facet_grid()</code> and <code>facet_panel()</code></h4>
<p>Sometimes, instead of using scales, we might want to show different groups using facets. This is where <code>facet_grid()</code> and <code>facet_wrap()</code> come in handy. If we have just one variable on which we want to stratify, we can create facets using <code>facet_wrap()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">colour =</span> island, <span class="at">fill =</span> island, <span class="at">linetype =</span> island)) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, , <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5"></a>    <span class="co"># Scaling</span></span>
<span id="cb35-6"><a href="#cb35-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb35-7"><a href="#cb35-7"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2500</span>, <span class="dv">6500</span>),</span>
<span id="cb35-8"><a href="#cb35-8"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>),</span>
<span id="cb35-9"><a href="#cb35-9"></a>                       <span class="at">labels =</span> <span class="fu">prettyNum</span>(<span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb35-10"><a href="#cb35-10"></a>                       <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Flipper length (millimeters)"</span>,</span>
<span id="cb35-12"><a href="#cb35-12"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">240</span>),</span>
<span id="cb35-13"><a href="#cb35-13"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">170</span>, <span class="dv">240</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb35-14"><a href="#cb35-14"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkorange"</span>, <span class="st">"purple"</span>, <span class="st">"cyan4"</span>), <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"colour"</span>, <span class="st">"fill"</span>)) <span class="sc">+</span></span>
<span id="cb35-15"><a href="#cb35-15"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>))  <span class="sc">+</span></span>
<span id="cb35-16"><a href="#cb35-16"></a>    <span class="co"># Labels</span></span>
<span id="cb35-17"><a href="#cb35-17"></a>    <span class="fu">ggtitle</span>(<span class="st">"Relation between penguin body mass and flipper length"</span>, <span class="at">subtitle =</span> <span class="st">"Data from the Palmer Archipelago penguins"</span>) <span class="sc">+</span></span>
<span id="cb35-18"><a href="#cb35-18"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>,</span>
<span id="cb35-19"><a href="#cb35-19"></a>           <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="st">"bottom"</span>)) <span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20"></a>    <span class="co"># Transformations</span></span>
<span id="cb35-21"><a href="#cb35-21"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(island))            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If we have multiply varialbes, <code>facet_grid()</code> can help us out:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">colour =</span> island, <span class="at">fill =</span> island, <span class="at">linetype =</span> island)) <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb38-3"><a href="#cb38-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, , <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5"></a>    <span class="co"># Scaling</span></span>
<span id="cb38-6"><a href="#cb38-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb38-7"><a href="#cb38-7"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2500</span>, <span class="dv">6500</span>),</span>
<span id="cb38-8"><a href="#cb38-8"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>),</span>
<span id="cb38-9"><a href="#cb38-9"></a>                       <span class="at">labels =</span> <span class="fu">prettyNum</span>(<span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb38-10"><a href="#cb38-10"></a>                       <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb38-11"><a href="#cb38-11"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Flipper length (millimeters)"</span>,</span>
<span id="cb38-12"><a href="#cb38-12"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">240</span>),</span>
<span id="cb38-13"><a href="#cb38-13"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">170</span>, <span class="dv">240</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb38-14"><a href="#cb38-14"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkorange"</span>, <span class="st">"purple"</span>, <span class="st">"cyan4"</span>), <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"colour"</span>, <span class="st">"fill"</span>)) <span class="sc">+</span></span>
<span id="cb38-15"><a href="#cb38-15"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>))  <span class="sc">+</span></span>
<span id="cb38-16"><a href="#cb38-16"></a>    <span class="co"># Labels</span></span>
<span id="cb38-17"><a href="#cb38-17"></a>    <span class="fu">ggtitle</span>(<span class="st">"Relation between penguin body mass and flipper length"</span>, <span class="at">subtitle =</span> <span class="st">"Data from the Palmer Archipelago penguins"</span>) <span class="sc">+</span></span>
<span id="cb38-18"><a href="#cb38-18"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>,</span>
<span id="cb38-19"><a href="#cb38-19"></a>           <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="st">"bottom"</span>)) <span class="sc">+</span></span>
<span id="cb38-20"><a href="#cb38-20"></a>    <span class="co"># Transformations</span></span>
<span id="cb38-21"><a href="#cb38-21"></a>    <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(species), <span class="at">cols =</span> <span class="fu">vars</span>(island))            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the facet functions, you can specify multiple things, including the labels given to the strips at the top and whether the axes should be allowed to differ between plots (which can be useful if you just want to create facets of a lot of histograms to show distributions).</p>
<p>Note that we still specified our scales such as <code>colour</code>, but that this is not required.</p>
</section>
</section>
<section id="layer-6-theme" class="level3">
<h3 class="anchored" data-anchor-id="layer-6-theme">Layer 6: theme</h3>
<p>The last layer we will discuss is the theme. <code>{ggplot2}</code> allows us to edit the aesthetics of the plot using <code>theme()</code> and offers some basic themes. For instance, we can just make a simple looking plot using <code>theme_bw()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="fu">ggplot</span>(penguins, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> flipper_length_mm, <span class="at">colour =</span> island, <span class="at">fill =</span> island, <span class="at">linetype =</span> island)) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>    <span class="co"># Geometries</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, , <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>    <span class="co"># Scaling</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb41-7"><a href="#cb41-7"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2500</span>, <span class="dv">6500</span>),</span>
<span id="cb41-8"><a href="#cb41-8"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>),</span>
<span id="cb41-9"><a href="#cb41-9"></a>                       <span class="at">labels =</span> <span class="fu">prettyNum</span>(<span class="fu">seq</span>(<span class="dv">2500</span>, <span class="dv">6500</span>, <span class="dv">500</span>), <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb41-10"><a href="#cb41-10"></a>                       <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb41-11"><a href="#cb41-11"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Flipper length (millimeters)"</span>,</span>
<span id="cb41-12"><a href="#cb41-12"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">240</span>),</span>
<span id="cb41-13"><a href="#cb41-13"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">170</span>, <span class="dv">240</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb41-14"><a href="#cb41-14"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"darkorange"</span>, <span class="st">"purple"</span>, <span class="st">"cyan4"</span>), <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"colour"</span>, <span class="st">"fill"</span>)) <span class="sc">+</span></span>
<span id="cb41-15"><a href="#cb41-15"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>))  <span class="sc">+</span></span>
<span id="cb41-16"><a href="#cb41-16"></a>    <span class="co"># Labels</span></span>
<span id="cb41-17"><a href="#cb41-17"></a>    <span class="fu">ggtitle</span>(<span class="st">"Relation between penguin body mass and flipper length"</span>, <span class="at">subtitle =</span> <span class="st">"Data from the Palmer Archipelago penguins"</span>) <span class="sc">+</span></span>
<span id="cb41-18"><a href="#cb41-18"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>,</span>
<span id="cb41-19"><a href="#cb41-19"></a>           <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">position =</span> <span class="st">"bottom"</span>)) <span class="sc">+</span></span>
<span id="cb41-20"><a href="#cb41-20"></a>    <span class="co"># Aesthetics</span></span>
<span id="cb41-21"><a href="#cb41-21"></a>    <span class="fu">theme_bw</span>()            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="plotting_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="common-errors" class="level3">
<h3 class="anchored" data-anchor-id="common-errors">Common errors</h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/rjjanse\.github\.io\/rt\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>